{% with calendar_id|default:'calendar' as cal_id %}
{% with min_time|default:'08:00:00' as min_t %}
{% with max_time|default:'20:00:00' as max_t %}

<div class="w-full bg-white rounded-lg shadow-sm overflow-hidden"></div>
    <div class="flex flex-col h-[calc(100vh-100px)]"> 
        <div id="{{ cal_id }}" class="flex-1 overflow-auto p-4"></div>
    </div>
</div>

<style>
    /* Container for scrollable calendar */
    .fc {
        height: 600px !important; /* Fixed height - adjust as needed */
        width: 100% !important;
    }
    
    /* Makes the time-grid section scrollable */
    .fc .fc-scroller {
        height: auto !important;
    }

    /* Customize current time indicator */
    .fc .fc-timegrid-now-indicator-line {
        border-color: #ff3b30;  /* Red color for time indicator */
        border-width: 2px;
        z-index: 100;
    }

    .fc .fc-timegrid-now-indicator-arrow {
        border-color: #ff3b30;  /* Red color for time indicator */
        margin-left: -5px;
    }

    /* Style time slots */
    .fc-timegrid-slots td {
        height: 3em !important;
    }

    /* Keep header fixed while scrolling */
    .fc .fc-scrollgrid-section-header {
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: white;
    }

    /* Your existing styles */
    .fc .fc-toolbar-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
    }
    
    .fc .fc-button {
        background-color: #3b82f6;
        border-color: #3b82f6;
        color: #ffffff;
        transition: all 0.2s ease;
        padding: 0.5rem 1rem;
        font-weight: 500;
        border-radius: 0.375rem;
    }
    
    .fc .fc-button:hover {
        background-color: #2563eb;
        border-color: #2563eb;
    }
    
    .fc .fc-timegrid-slot-label {
        color: #6b7280;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .fc .fc-day-today {
        background-color: rgba(59, 130, 246, 0.05) !important;
    }
    
    .fc-theme-standard td, 
    .fc-theme-standard th {
        border-color: #e5e7eb;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('{{ cal_id }}');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            slotMinTime: '00:00:00',  // Start from midnight
            slotMaxTime: '24:00:00',  // End at midnight
            dayMaxEvents: true,
            allDaySlot: false,
            slotDuration: '00:30:00',
            nowIndicator: true,        // Enable current time indicator
            scrollTime: '06:00:00',    // Scroll to 6 AM when loading
            height: 'auto',
            expandRows: true,
            stickyHeaderDates: true,
            weekNumbers: false,
            navLinks: true,
            slotLabelFormat: {
                hour: 'numeric',
                minute: '2-digit',
                omitZeroMinute: true,
                meridiem: 'short'
            },
            businessHours: {
                daysOfWeek: [1, 2, 3, 4, 5],
                startTime: '08:00',
                endTime: '20:00',
            }
        });
        calendar.render();

        // Scroll to current time on load
        const scrollToCurrentTime = () => {
            const currentTime = new Date();
            const currentHour = currentTime.getHours();
            const currentMinute = currentTime.getMinutes();
            
            // Calculate scroll position (each hour is approximately 60px high)
            const scrollPosition = (currentHour * 60 + currentMinute) * (3 * 16 / 60); // 3em converted to pixels
            
            const timeGridScroller = document.querySelector('.fc-timegrid-body');
            if (timeGridScroller) {
                timeGridScroller.scrollTop = scrollPosition - 200; // Scroll a bit above current time
            }
        };

        // Apply scroll after a short delay to ensure calendar is fully rendered
        setTimeout(scrollToCurrentTime, 100);
    });
</script>
{% endwith %}
{% endwith %}
{% endwith %}